<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Plants vs Zombies 2.0</title>
  <style>
    body { margin:0; background:#4caf50; font-family:sans-serif; color:white; user-select:none; }
    #hud { background:rgba(0,0,0,0.5); padding:10px; font-size:20px; }
    #game {
      position:relative; width:100vw; height:80vh;
      background:#3e7a2a; display:grid;
      grid-template-rows:repeat(5,1fr); grid-template-columns:repeat(9,1fr);
      border:4px solid #2c5d1c;
    }
    .cell { border:1px solid rgba(255,255,255,0.2); position:relative; }
    .plant { width:100%; height:100%; display:flex; justify-content:center; align-items:center; font-size:24px; }
    .zombie { position:absolute; width:60px; height:80px; background:brown; color:white; text-align:center; line-height:80px; border-radius:10px; font-size:22px; }
    .pea { position:absolute; width:15px; height:15px; border-radius:50%; }
    .pea.normal { background:yellow; }
    .pea.ice { background:cyan; }
    .pea.fire { background:red; }
    #message { position:fixed; inset:0; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.7); font-size:48px; font-weight:bold; }
    #message.hidden { display:none; }
  </style>
</head>
<body>
  <div id="hud">‚òÄÔ∏è Slunce: <span id="sun">100</span></div>
  <div id="game"></div>
  <div id="message" class="hidden"></div>
  <script>
    const game = document.getElementById("game");
    const sunCounter = document.getElementById("sun");
    const msg = document.getElementById("message");

    let sun = 100;
    let cells=[], plants=[], zombies=[], peas=[];
    const rows=5, cols=9;
    let wave=0, maxWaves=4;

    // === GRID ===
    for (let r=0;r<rows;r++) {
      cells[r]=[];
      for (let c=0;c<cols;c++) {
        const cell=document.createElement("div");
        cell.className="cell"; game.appendChild(cell);
        cells[r][c]=cell;

        cell.addEventListener("click",()=>{
          if(cell.hasPlant) return;
          let p=prompt("Vyber rostlinu:\n1=St≈ôelec(50)\n2=Dvojst≈ôelec(100)\n3=Sluneƒçnice(50)\n4=Ledov√°(125)\n5=Ohniv√°(150)","1");
          if(p==="1"&&sun>=50) addPlant(r,c,"pea",50,"üå±");
          else if(p==="2"&&sun>=100) addPlant(r,c,"double",100,"üåº");
          else if(p==="3"&&sun>=50) addPlant(r,c,"sunflower",50,"üåª");
          else if(p==="4"&&sun>=125) addPlant(r,c,"ice",125,"üåµ");
          else if(p==="5"&&sun>=150) addPlant(r,c,"fire",150,"üå∂Ô∏è");
        });
      }
    }

    function addPlant(r,c,type,cost,emoji){
      sun-=cost; sunCounter.textContent=sun;
      const plant=document.createElement("div");
      plant.className="plant"; plant.textContent=emoji;
      cells[r][c].appendChild(plant); cells[r][c].hasPlant=true;
      plants.push({r,c,el:plant,type,cooldown:0});
    }

    function spawnWave(){
      if(wave>=maxWaves) return;
      wave++;
      for(let i=0;i<wave+2;i++) setTimeout(()=>spawnZombie(),i*2000);
    }

    function spawnZombie(){
      const r=Math.floor(Math.random()*rows);
      const zombie=document.createElement("div");
      zombie.className="zombie";
      zombie.style.top=`${r*(game.clientHeight/rows)+10}px`;
      zombie.style.left=`${game.clientWidth-60}px`;

      // typ zomb√≠ka
      let type=Math.random();
      let hp=6, speed=0.5, emoji="üßü";
      if(type<0.2){ hp=4; speed=1; emoji="üèÉ"; }         // rychl√Ω
      else if(type>0.8){ hp=12; speed=0.3; emoji="ü™ñ"; } // obrnƒõn√Ω

      zombie.textContent=emoji;
      game.appendChild(zombie);
      zombies.push({r,x:game.clientWidth-60,el:zombie,hp,speed,slow:1});
    }

    function loop(){
      // rostliny
      plants.forEach(p=>{
        p.cooldown--;
        if(p.type==="sunflower"&&p.cooldown<=0){ sun+=25; sunCounter.textContent=sun; p.cooldown=300; }
        if((p.type==="pea"||p.type==="double"||p.type==="ice"||p.type==="fire")&&p.cooldown<=0){
          shoot(p.r,p.c,p.type);
          if(p.type==="double") setTimeout(()=>shoot(p.r,p.c,"pea"),200);
          p.cooldown=80;
        }
      });

      // hr√°≈°ky
      peas.forEach((pea,i)=>{
        pea.x+=5; pea.el.style.left=pea.x+"px";
        zombies.forEach((z,zi)=>{
          if(pea.x>z.x && pea.y>parseInt(z.el.style.top)&&pea.y<parseInt(z.el.style.top)+80){
            // damage podle typu
            let dmg=1;
            if(pea.type==="fire") dmg=2;
            z.hp-=dmg;
            if(pea.type==="ice") z.slow=0.5;

            pea.el.remove(); peas.splice(i,1);
            if(z.hp<=0){ z.el.remove(); zombies.splice(zi,1); sun+=25; sunCounter.textContent=sun; checkWin(); }
          }
        });
        if(pea.x>game.clientWidth){ pea.el.remove(); peas.splice(i,1); }
      });

      // zomb√≠ci
      zombies.forEach((z,i)=>{
        z.x-=z.speed*z.slow;
        z.el.style.left=z.x+"px";
        if(z.x<0) endGame(false);
      });

      requestAnimationFrame(loop);
    }

    function shoot(r,c,type){
      const pea=document.createElement("div");
      pea.className="pea "+(type==="ice"?"ice":type==="fire"?"fire":"normal");
      const rect=cells[r][c].getBoundingClientRect(), grect=game.getBoundingClientRect();
      pea.style.top=`${rect.top-grect.top+30}px`;
      pea.style.left=`${rect.left-grect.left+40}px`;
      game.appendChild(pea);
      peas.push({x:parseInt(pea.style.left),y:parseInt(pea.style.top),el:pea,type});
    }

    function checkWin(){ if(zombies.length===0&&wave>=maxWaves) endGame(true); }
    function endGame(win){
      msg.classList.remove("hidden");
      msg.textContent=win?"üéâ Vyhr√°l jsi!":"üíÄ Prohr√°l jsi!";
      setTimeout(()=>location.reload(),4000);
    }

    spawnWave();
    setInterval(spawnWave,15000);
    loop();
  </script>
</body>
</html>
